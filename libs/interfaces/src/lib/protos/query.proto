syntax = "proto3";

option csharp_namespace = "Query";
package QUERY_SERVICE;

service QueryService {
  rpc GetCategory(GetCategoryRequest) returns (GetCategoryResponse);
  rpc GetManyCategories(GetManyCategoriesRequest) returns (GetManyCategoriesResponse);

  rpc GetBrand(GetBrandRequest) returns (GetBrandResponse);
  rpc GetManyBrands(GetManyBrandsRequest) returns (GetManyBrandsResponse);

  rpc GetAttribute(GetAttributeRequest) returns (GetAttributeResponse);
  rpc GetManyAttributes(GetManyAttributesRequest) returns (GetManyAttributesResponse);


  rpc GetProduct(GetProductRequest) returns (GetProductResponse);
  rpc GetManyProducts(GetManyProductsRequest) returns (GetManyProductsResponse);

  rpc GetNotification(GetNotificationRequest) returns (NotificationResponse);
  rpc GetManyNotifications(GetManyNotificationsRequest) returns (GetManyNotificationsResponse);

  rpc GetManyOrders(GetManyOrdersRequest) returns (GetManyOrdersResponse);
  rpc GetOrder(GetOrderRequest) returns (GetOrderResponse);

  rpc GetManyVideos(GetManyVideosRequest) returns (GetManyVideosResponse);
  rpc GetVideo(GetVideoRequest) returns (VideoResponse);

  rpc GetManyProductReviews(GetManyProductReviewsRequest) returns (GetManyProductReviewsResponse);
}

//====================================== Category ======================================//
message CategoryProduct {
  string id = 1;
  string name = 2;
  string logo = 3;
  optional string parentCategoryId = 4;
}
//==================== GetCategoryRequest ====================//
message GetCategoryRequest {
  optional string processId = 1;
  string id = 2;
}

message GetCategoryResponse {
  string id = 1;
  string name = 2;
  string logo = 3;
  optional string parentId = 4;
  string path = 5;
  int32 level = 6;
  string createdAt = 7;
  string updatedAt = 8;
}

//==================== GetManyCategoriesRequest ====================//
message GetManyCategoriesRequest {
  optional string processId = 1;
  optional string parentCategoryId = 2;
}

message GetManyCategoriesResponse {
  repeated GetCategoryResponse categories = 1;
}

//====================================== Brand ======================================//
//==================== GetBrandRequest ====================//
message GetBrandRequest {
  optional string processId = 1;
  string id = 2;
}

message GetBrandResponse {
  string id = 1;
  string name = 2;
  string logo = 3;
  int32 productsCount = 4;
  int32 soldCount = 5;
  repeated string categoryIds = 6;
  repeated CategoryProduct categories = 7;
  string createdAt = 8;
  string updatedAt = 9;
}

//==================== GetManyBrandsRequest ====================//
message GetManyBrandsRequest {
  optional string processId = 1;
  int32 page = 2;
  int32 limit = 3;
  optional string name = 4;
}

message GetManyBrandsResponse {
  repeated GetBrandResponse brands = 1;
  int32 page = 2;
  int32 limit = 3;
  int32 totalItems = 4;
  int32 totalPages = 5;
}

//====================================== Attribute ======================================//
//==================== GetAttributeRequest ====================//
message GetAttributeRequest {
  optional string processId = 1;
  string id = 2;
}

message GetAttributeResponse {
  string id = 1;
  string name = 2;
  repeated string categoryIds = 3;
  repeated CategoryProduct categories = 4;
  string createdAt = 5;
  string updatedAt = 6;
}

//==================== GetManyAttributesRequest ====================//
message GetManyAttributesRequest {
  optional string processId = 1;
  int32 page = 2;
  int32 limit = 3;
  optional string name = 4;
}

message GetManyAttributesResponse {
  repeated GetAttributeResponse attributes = 1;
  int32 page = 2;
  int32 limit = 3;
  int32 totalItems = 4;
  int32 totalPages = 5;
}

//====================================== Product ======================================//
message Variant {
  string value = 1;
  repeated string options = 2;
}

message AttributeProduct {
  string name = 1;
  string value = 2;
}

message SKU {
  string id = 1;
  string value = 2;
  double price = 3;
  int32 stock = 4;
  optional string image = 5;
}

//==================== GetProductRequest ====================//
message GetProductRequest {
  optional string processId = 1;
  string id = 2;
  optional string shopId = 3;
}

message GetProductResponse {
  string id = 1;
  string name = 2;
  optional string description = 3;
  
  int32 provinceId = 4;
  int32 districtId = 5;
  int32 wardId = 6;

  optional string brandId = 7;
  optional string brandName = 8;
  optional string brandLogo = 9;

  repeated string categoryIds = 10;
  repeated CategoryProduct categories = 11;

  double basePrice = 12;
  double virtualPrice = 13;
  double minPrice = 14;
  double maxPrice = 15;

  int32 totalStock = 16;
  bool isAvailable = 17;

  repeated string images = 18;
  optional string sizeGuide = 19;

  repeated Variant variants = 20;
  repeated AttributeProduct attributes = 21;
  repeated SKU skus = 22;

  repeated string reviewIds = 23;
  int32 ratingCount = 24;
  double averageRate = 25;
  int32 soldCount = 26;
  int32 viewCount = 27;
  int32 likeCount = 28;

  string shopId = 29;
  string status = 30;
  bool isApproved = 31;
  bool isHidden = 32;

  string createdAt = 33;
  string updatedAt = 34;
}

//==================== GetManyProductsRequest ====================//
message GetManyProductsRequest {
  optional string processId = 1;
  int32 page = 2;
  int32 limit = 3;
  optional string name = 4;
  optional string status = 5;
  optional string shopId = 6;
  repeated string brandIds = 7;
  repeated string categories = 8;
  optional double minPrice = 9;
  optional double maxPrice = 10;
  optional string sortBy = 11;
  optional string orderBy = 12;
}

message GetManyProductsResponse {
  repeated GetProductResponse products = 1;
  int32 page = 2;
  int32 limit = 3;
  int32 totalItems = 4;
  int32 totalPages = 5;
}


//====================================== Notifications ======================================//
//==================== GetNotificationRequest ====================//
message GetNotificationRequest {
  optional string processId = 1;
  string id = 2;
  string userId = 3;
}
//==================== GetManyNotificationsRequest ====================//
message GetManyNotificationsRequest {
  optional string processId = 1;
  int32 page = 2;
  int32 limit = 3;
  string userId = 4;
}

message GetManyNotificationsResponse {
  repeated NotificationResponse notifications = 1;
  int32 page = 2;
  int32 limit = 3;
  int32 totalItems = 4;
  int32 totalPages = 5;
}

message Metadata {
  optional string orderId = 1;
  optional string articleId = 2;
}

message NotificationResponse {
  string id = 1;
  string userId = 2;
  string type = 3;
  string title = 4;
  string description = 5;
  optional string link = 6;
  optional string image = 7;
  bool isRead = 8;
  optional Metadata metadata = 9;
  string createdAt = 10;
  string updatedAt = 11;
}

//====================================== Orders ======================================//
//==================== GetManyOrdersRequest ====================//
message GetManyOrdersRequest {
  optional string processId = 1;
  int32 page = 2;
  int32 limit = 3;
  optional string paymentId = 4;
  optional string status = 5;
  optional string userId = 6;
  optional string shopId = 7;
}

message OrderSummary {
  string id = 1;
  string shopId = 2;
  string shopName = 3;
  string status = 4;
  int32 itemTotal = 5;
  int32 grandTotal = 6;
  string firstProductImage = 7;
  string firstProductName = 8;
}

message GetManyOrdersResponse {
  repeated OrderSummary orders = 1;
  int32 page = 2;
  int32 limit = 3;
  int32 totalItems = 4;
  int32 totalPages = 5;
}

//==================== GetOrderRequest ====================//
message GetOrderRequest {
  optional string processId = 1;
  string orderId = 2;
  optional string userId = 3;
  optional string shopId = 4;
}

message Receiver {
  string name = 1;
  string phoneNumber = 2;
  string address = 3;
}

message Timeline {
  string status = 1;
  string at = 2;
}

message OrderItemSnapshot {
  string id = 1;
  string productId = 2;
  string productImage = 3;
  string productName = 4;
  string skuValue = 5;
  int32 quantity = 6;
  int32 price = 7;
}

message GetOrderResponse {
  string id = 1;
  string code = 2;
  string userId = 3;
  string shopId = 4;
  string shopName = 5;
  string status = 6;
  string paymentMethod = 7;
  string paymentStatus = 8;
  string paymentId = 9;
  int32 itemTotal = 10;
  int32 shippingFee = 11;
  int32 discount = 12;
  int32 grandTotal = 13;
  Receiver receiver = 14;
  string receiverName = 15;
  string receiverPhone = 16;
  string receiverAddress = 17;
  Timeline timeline = 18;
  repeated OrderItemSnapshot itemsSnapshot = 19;
  string firstProductName = 20;
  string firstProductImage = 21;
  string createdAt = 22;
  string updatedAt = 23;
}

//====================================== Video ======================================//
//==================== GetVideoRequest ====================//
message GetVideoRequest {
  optional string processId = 1;
  string id = 2;
  optional string status = 3;
}

message VideoResponse {
  string id = 1;
  string storageBucket = 2;
  string storageKey = 3;
  string filetype = 4;
  int32 size = 5;
  string status = 6;
  int32 duration = 7;
  int32 width = 8;
  int32 height = 9;
  string createdAt = 10;
  string updatedAt = 11;
  string title = 12;
  int32 likeCount = 13;
  int32 commentCount = 14;
  string authorId = 15;
  optional string authorUsername = 16;
  optional string authorAvatar = 17;
}

//==================== GetManyVideosRequest ====================//
message GetManyVideosRequest {
  optional string processId = 1;
  int32 page = 2;
  int32 limit = 3;
  optional string userId = 4;
  optional string status = 5;
  optional string title = 6;
}

message VideoBasicInfo {
  string id = 1;
  int32 size = 2;
  int32 duration = 3;
  int32 width = 4;
  int32 height = 5;
  string status = 6;
  string title = 7;
  int32 likeCount = 8;
  int32 commentCount = 9;
  string authorId = 10;
}

message GetManyVideosResponse {
  int32 page = 1;
  int32 limit = 2;
  int32 totalItems = 3;
  int32 totalPages = 4;
  repeated VideoBasicInfo videos = 5;
}

//====================================== Reviews ======================================//
//==================== GetManyProductReviewsRequest ====================//
message GetManyProductReviewsRequest {
  optional string processId = 1;
  int32 page = 2;
  int32 limit = 3;
  string productId = 4;
  int32 rating = 5;
}

message ReviewReply {
  string id = 1;
  string sellerId = 2;
  string content = 3;
  string createdAt = 4;
  string updatedAt = 5;
}

message ReviewItem {
  string id = 1;
  string userId = 2;
  int32 rating = 3;
  string content = 4;
  repeated string medias = 5;
  optional ReviewReply reply = 6;
  string createdAt = 7;
  optional string updatedAt = 8;
}

message ProductRatingStats {
  string productId = 1;
  double averageRating = 2;
  int32 totalReviews = 3;
  int32 oneStarCount = 4;
  int32 twoStarCount = 5;
  int32 threeStarCount = 6;
  int32 fourStarCount = 7;
  int32 fiveStarCount = 8;
}

message GetManyProductReviewsResponse {
  repeated ReviewItem reviews = 1;
  ProductRatingStats rating = 2;
  int32 page = 3;
  int32 limit = 4;
  int32 totalItems = 5;
  int32 totalPages = 6;
}
