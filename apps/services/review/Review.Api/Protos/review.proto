syntax = "proto3";

package REVIEW_SERVICE;
option csharp_namespace = "Review.Grpc";


enum ReviewRating {
  REVIEW_RATING_UNSPECIFIED = 0;
  RATING_1 = 1;
  RATING_2 = 2;
  RATING_3 = 3;
  RATING_4 = 4;
  RATING_5 = 5;
}

// Entities / DTOs
message ReviewReply {
  string id = 1;
  string review_id = 2;
  string seller_id = 3;
  string content = 4;
  string created_at = 5;
  string updated_at = 6;
}

message Review {
  string id = 1;

  string user_id = 2;
  string product_id = 3;
  string order_item_id = 4;
  string order_id = 5;

  ReviewRating rating = 6;
  string content = 7;
  repeated string medias = 8;

  ReviewReply replies = 9;

  string created_at = 11; 
  string updated_at = 12; 
}

message ProductRatingStats {
  string product_id = 1;

  double average_rating = 2;
  int64 total_reviews = 3;

  int64 one_star_count = 4;
  int64 two_star_count = 5;
  int64 three_star_count = 6;
  int64 four_star_count = 7;
  int64 five_star_count = 8;

  int64 reviews_with_media_count = 9;
}

message SellerRatingStats {
  string seller_id = 1;

  double average_rating = 2;
  int64 total_reviews = 3;

  int64 one_star_count = 4;
  int64 two_star_count = 5;
  int64 three_star_count = 6;
  int64 four_star_count = 7;
  int64 five_star_count = 8;
}

message DashboardReviewStats {
  int64 total_reviews = 1;

  int64 one_star_count = 2;
  int64 two_star_count = 3;
  int64 three_star_count = 4;
  int64 four_star_count = 5;
  int64 five_star_count = 6;

  int64 reviews_with_media = 7;
}

message DashboardSellerReviewStats {
  int64 total_reviews = 1;
  double average_rating = 2;

  int64 one_star_count = 3;
  int64 two_star_count = 4;
  int64 three_star_count = 5;
  int64 four_star_count = 6;
  int64 five_star_count = 7;

  int64 reviews_with_media = 8;
}

// Paging helper
message PageInfo {
  int32 page = 1;
  int32 limit = 2;
  int64 total = 3;
}

//  ========================== Requests / Responses ==========================
// --- Create ---

message CreateReviewRequest {
  string user_id = 1;
  string order_item_id = 2;
  string order_id = 3;

  ReviewRating rating = 4;
  string content = 5;
  repeated string medias = 6;
}

message CreateReviewResponse {
  Review review = 1;
}

message CreateReplyRequest {
  string seller_id = 1;
  string review_id = 2;
  string content = 3;
}

message CreateReplyResponse {
  Review review = 1;
}

// --- Update ---

message UpdateReviewRequest {
  string user_id = 1;
  string id = 2;
  optional ReviewRating rating = 3;
  optional string content = 4;
  repeated string medias = 5;
}

message UpdateReviewResponse {
  Review review = 1;
}

message UpdateReplyRequest {
  string seller_id = 1;
  string id = 2; 
  string content = 3;
}

message UpdateReplyResponse {
  Review review = 1;
}

// --- Delete ---

message DeleteReviewRequest {
  string user_id = 1;
  string id = 2;
}

message DeleteReviewResponse {
  bool success = 1;
}

message DeleteReplyRequest {
  string seller_id = 1;
  string id = 2;
}

message DeleteReplyResponse {
  bool success = 1;
}

// --- Get single review (client) ---

message GetReviewRequest {
  string user_id = 1;
  string id = 2;
}

message GetReviewResponse {
  Review review = 1;
}

// ==========================
// Filters (My / Admin)
// ==========================

message GetMyReviewsRequest {
  string user_id = 1;
  string product_id = 2;

  string from_date = 3; 
  string to_date = 4;

  int32 min_rating = 5;
  int32 max_rating = 6;

  string sort_by = 7;

  int32 page = 8;
  int32 limit = 9;
}

message GetMyReviewsResponse {
  repeated Review items = 1;
  PageInfo page_info = 2;
}

message GetReviewsAdminRequest {
  string admin_id = 1;
  string user_id = 2;
  string seller_id = 3;
  string product_id = 4;

  string from_date = 5;
  string to_date = 6;

  int32 min_rating = 7;
  int32 max_rating = 8;

  string sort_by = 9;
  int32 page = 10;
  int32 limit = 11;
}

message GetReviewsAdminResponse {
  repeated Review items = 1;
  PageInfo page_info = 2;
}

// Map vá»›i GetReviewByIdAdmin(string reviewId)
message GetReviewByIdAdminRequest {
  string admin_id = 1;
  string id = 2;
}

message GetReviewByIdAdminResponse {
  Review review = 1;
}

//  ========================== Rating ==========================

message GetProductRatingRequest {
  string product_id = 1;
}

message GetProductRatingResponse {
  ProductRatingStats rating = 1;
}

message GetSellerRatingRequest {
  string seller_id = 1;
}

message GetSellerRatingResponse {
  SellerRatingStats stats = 1;
}

//  ========================== Dashboard ==========================

message GetDashboardReviewStatsRequest {
  string admin_id = 1;
}

message GetDashboardReviewStatsResponse {
  DashboardReviewStats stats = 1;
}

message GetDashboardSellerReviewStatsRequest {
  string seller_id = 1;
  string seller_id_auth = 2;
}

message GetDashboardSellerReviewStatsResponse {
  DashboardSellerReviewStats stats = 1;
}

service ReviewService {

  // Admin get
  rpc GetReviewsAdmin(GetReviewsAdminRequest) returns (GetReviewsAdminResponse);
  rpc GetReviewByIdAdmin(GetReviewByIdAdminRequest) returns (GetReviewByIdAdminResponse);

  // User / Seller get
  rpc GetMyReviews(GetMyReviewsRequest) returns (GetMyReviewsResponse);
  rpc GetProductRating(GetProductRatingRequest) returns (GetProductRatingResponse);
  rpc GetSellerRating(GetSellerRatingRequest) returns (GetSellerRatingResponse);

  // Single review for client
  rpc GetReview(GetReviewRequest) returns (GetReviewResponse);

  // Create
  rpc CreateReview(CreateReviewRequest) returns (CreateReviewResponse);
  rpc CreateReply(CreateReplyRequest) returns (CreateReplyResponse);

  // Update
  rpc UpdateReview(UpdateReviewRequest) returns (UpdateReviewResponse);
  rpc UpdateReply(UpdateReplyRequest) returns (UpdateReplyResponse);

  // Delete
  rpc DeleteReview(DeleteReviewRequest) returns (DeleteReviewResponse);
  rpc DeleteReply(DeleteReplyRequest) returns (DeleteReplyResponse);

  // Dashboard
  rpc GetDashboardReviewStats(GetDashboardReviewStatsRequest) returns (GetDashboardReviewStatsResponse);
  rpc GetDashboardSellerReviewStats(GetDashboardSellerReviewStatsRequest) returns (GetDashboardSellerReviewStatsResponse);
}
