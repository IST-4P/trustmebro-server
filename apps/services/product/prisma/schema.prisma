generator client {
    provider      = "prisma-client"
    output        = "../src/generated/prisma-client"
    moduleFormat  = "cjs"
    binaryTargets = ["native", "debian-openssl-1.1.x"]
}

generator json {
    provider = "prisma-json-types-generator"
}

datasource db {
    provider = "postgresql"
}

enum ProductStatus {
    ACTIVE
    INACTIVE
    BANNED
    DRAFT
}

model Category {
    id                 String     @id @default(uuid())
    products           Product[]  @relation("ProductCategories")
    name               String     @db.VarChar(500)
    logo               String?    @db.VarChar(1000)
    parentCategoryId   String?
    parentCategory     Category?  @relation("ParentCategoryCategories", fields: [parentCategoryId], references: [id], onDelete: SetNull, onUpdate: NoAction)
    childrenCategories Category[] @relation("ParentCategoryCategories")

    createdById String?
    updatedById String?
    deletedById String?

    deletedAt DateTime?
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt

    @@index([name])
    @@index([parentCategoryId])
    @@index([deletedAt])
}

model Brand {
    id       String    @id @default(uuid())
    logo     String    @db.VarChar(1000)
    products Product[]
    name     String    @db.VarChar(500)

    createdById String?
    updatedById String?
    deletedById String?

    deletedAt DateTime?
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt

    @@unique([name])
    @@index([deletedAt])
}

model Product {
    id          String @id @default(uuid())
    name        String
    description String @db.Text

    provinceId   Int
    provinceName String

    districtId   Int
    districtName String

    wardId   Int
    wardName String

    sizeGuide    String?    @db.Text
    basePrice    Float      @default(0)
    virtualPrice Float      @default(0)
    brandId      String?
    brand        Brand?     @relation(fields: [brandId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    images       String[]
    categories   Category[] @relation("ProductCategories")
    /// [Variants]
    variants     Json // Thuộc tính như màu sắc kích thước
    skus         SKU[]
    reviewIds    String[]

    shopId String

    status ProductStatus @default(DRAFT)

    likeCount   Int     @default(0)
    ratingCount Int     @default(0)
    ratingSum   Int     @default(0)
    averageRate Float   @default(0)
    /// [Attributes]
    attributes  Json
    soldCount   Int     @default(0)
    viewCount   Int     @default(0)
    isApproved  Boolean @default(false)
    isHidden    Boolean @default(false)

    createdById String?
    updatedById String?
    deletedById String?

    deletedAt DateTime?
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt

    @@index([isHidden])
    @@index([shopId])
    @@index([brandId])
    @@index([createdById])
    @@index([name])
    @@index([deletedAt])
    @@index([provinceId])
    @@index([districtId])
}

model Attribute {
    id   String  @id @default(uuid())
    name String  @db.VarChar(255)
    url  String?

    createdById String?
    updatedById String?
    deletedById String?

    deletedAt DateTime?
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt

    @@unique([name])
    @@index([deletedAt])
}

model SKU {
    id        String  @id @default(uuid())
    value     String  @db.VarChar(500)
    price     Float
    stock     Int
    image     String?
    productId String
    product   Product @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: NoAction)

    createdById String?
    updatedById String?
    deletedById String?

    deletedAt DateTime?
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt

    @@unique([productId, value])
    @@index([deletedAt])
    @@index([productId])
}
