services:
  order:
    image: caophi562005/trustmebro-order
    pull_policy: always
    mem_limit: 256m
    memswap_limit: 512m
    env_file:
      - .env
    environment:
      - ORDER_SERVICE_GRPC_URL=0.0.0.0:5008
    # ports:
    #   - "3008:3008"
    # depends_on:
    #   kafka:
    #     condition: service_healthy
    restart: unless-stopped
    networks:
      - trustmebro-network
    healthcheck:
      test:
        [
          "CMD-SHELL",
          'node -e "fetch(''http://localhost:3008/api/v1/health/readiness'').then(r=>process.exit(r.ok?0:1)).catch(()=>process.exit(1))"',
        ]
      interval: 60s
      timeout: 20s
      retries: 3
      start_period: 60s

networks:
  trustmebro-network:
    external: true
