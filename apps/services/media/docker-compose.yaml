services:
  media:
    image: caophi562005/trustmebro-media
    pull_policy: always
    env_file:
      - .env
    environment:
      - MEDIA_SERVICE_GRPC_URL=0.0.0.0:5001
    ports:
      - "3001:3001"
    # depends_on:
    #   kafka:
    #     condition: service_healthy
    restart: unless-stopped
    networks:
      - trustmebro-network
    healthcheck:
      test:
        [
          "CMD-SHELL",
          'node -e "fetch(''http://localhost:3001/api/v1/health/readiness'').then(r=>process.exit(r.ok?0:1)).catch(()=>process.exit(1))"',
        ]
      interval: 60s
      timeout: 20s
      retries: 3
      start_period: 60s

networks:
  trustmebro-network:
    external: true
