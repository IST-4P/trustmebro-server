generator client {
    provider     = "prisma-client"
    // output       = "../../../../node_modules/@prisma-clients/role"
    output       = "../src/generated/prisma-client"
    moduleFormat = "cjs"
    // binaryTargets = ["native", "debian-openssl-1.1.x"]
}

datasource db {
    provider = "postgresql"
}

enum HTTP_METHOD {
    GET
    POST
    PUT
    DELETE
    PATCH
    OPTIONS
    HEAD
}

model Permission {
    id          String      @id @default(uuid())
    name        String      @db.VarChar(500)
    description String      @default("")
    path        String      @db.VarChar(1000)
    method      HTTP_METHOD
    module      String      @default("") @db.VarChar(500)
    roles       Role[]

    createdById String?
    updatedById String?
    deletedById String?

    deletedAt DateTime?
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt

    @@unique([name])
    @@index([deletedAt])
}

model Role {
    id          String       @id @default(uuid())
    name        String       @db.VarChar(500)
    description String       @default("")
    permissions Permission[]

    parents     RoleInheritance[] @relation("ChildRoles") // role cha của role này
    children    RoleInheritance[] @relation("ParentRoles") // role con của role này
    // nếu là customer , nó sẽ có children nơi nó làm parent
    // nếu là seller , nó sẽ có parent nơi nó làm children ?
    createdById String?
    updatedById String?
    deletedById String?

    deletedAt DateTime?
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt

    @@index([deletedAt])
}

model RoleInheritance {
    id String @id @default(uuid())

    parentId String
    childId  String

    parent Role @relation("ParentRoles", fields: [parentId], references: [id])
    child  Role @relation("ChildRoles", fields: [childId], references: [id])

    createdAt DateTime @default(now())
}
